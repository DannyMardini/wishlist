<?php

namespace Wishlist\CoreBundle\Repository;

use Doctrine\ORM\EntityRepository;
use Doctrine\ORM\NoResultException;

/**
 * WishlistUserRepository
 *
 * This class was generated by the Doctrine ORM. Add your own custom
 * repository methods below.
 */
class WishlistUserRepository extends EntityRepository
{
    public function getUser($fullname)
    {
        $name = explode(" ", $fullname);
        $first = $name[0];
        $last = $name[1];
        
        return $this->findOneBy(array('firstname' => $first, 'lastname' => $last));
    }

//    public static function addWishlistUser( $email )
//    {
//        $em = $this->getEntityManager();
//        
//        $new_wishlistUser = new WishlistUser();
//        $new_wishlistUser->setEmail($email);
//        $new_wishlistUser->setName('Blanca Edmiston');
//        $new_wishlistUser->setGender(1);
//        $new_wishlistUser->setAge(50);
//        $new_wishlistUser->setPassword('iLoveBob');
//        $new_wishlistUser->save();
//    }
    
    public function validateEmailAndPassword( $email, $password )
    {
        try
        {                                                    
            $q = $this->getEntityManager()
                    ->createQuery('SELECT w FROM WishlistCoreBundle:WishlistUser w WHERE w.email = :email AND w.password = :password')
                    ->setParameter('email', $email)
                    ->setParameter('password', $password);
            
            $userQueryResults = $q->getResult();
            
            $userId = 0;
                        
            foreach ($userQueryResults as $user)
            {
                $userId = $user->getWishlistuserId();
            }        
            
            return $userId;
        }catch(Exception $e)
        {
            return 0;
        }
    }
    
    public function getUserWithEmail( $email )
    {
        $user = $this->findOneBy(array('email' => $email));

        if(!isset ($user))
        {
            throw new NoResultException();
        }

        return $user;
    }
}