<?php

namespace Wishlist\CoreBundle\Repository;

use Doctrine\ORM\EntityRepository;
use Wishlist\CoreBundle\Entity\Friendship;
use Wishlist\CoreBundle\Entity\WishlistUser;

/**
 * FrienshipRepository
 *
 * This class was generated by the Doctrine ORM. Add your own custom
 * repository methods below.
 */
class FriendshipRepository extends EntityRepository
{
    public function addNewFriendship(WishlistUser $userA, WishlistUser $userB)
    {
        $this->addNewFriendLink($userA, $userB);
        $this->addNewFriendLink($userB, $userA);
        
        $this->getEntityManager()->flush();
    }
    
    private function addNewFriendLink(WishlistUser $userA, WishlistUser $userB)
    {
        $friendship = new Friendship();
        
        $friendship->setWishlistUser($userA);
        $friendship->setFriend($userB);
        
        $this->getEntityManager()->persist($friendship);
    }
    
//    public static function getInstance()
//    {
//        return Doctrine_Core::getTable('Friendship');
//    }
//
//    public function getFriendsOf($user)
//    {
//        $q = $this->createQuery()->where('usera_id = ?', $user);
//
//        $friendships = $q->execute();
//
//        foreach ($friendships as $friendship)
//        {
//            $friend_ids[] = $friendship->getUserbId();
//        }
//
//        if($friend_ids)
//        {
//            return WishlistUserTable::getInstance()->createQuery('w')->whereIn('w.wishlistuser_id', $friend_ids)->execute();
//        }
//    }
//
//    public function createFriendship($userA, $userB)
//    {
//        $friendshipA = new Friendship();
//        $friendshipA->setUseraId($userA);
//        $friendshipA->setUserbId($userB);
//
//        $friendshipB = new Friendship();
//        $friendshipB->setUseraId($userB);
//        $friendshipB->setUserbId($userA);
//
//        $friendshipA->save();
//        $friendshipB->save();
//    }
}