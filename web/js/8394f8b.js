var searchTimeout=0.5;var timer=0;function searchFriends(){var a=$("#friendSearch").val();$.ajax({type:"POST",url:Routing.generate("WishlistUserBundle_friendSearch"),data:{searchTerm:a},success:function(c,d,b){updateFriendList(jQuery.parseJSON(c))}})}function timerEnd(){window.clearTimeout(timer)}function timerRestart(){timerEnd();timer=window.setTimeout(searchFriends,searchTimeout*1000)}function modifyAddButton(a,d,b,c){console.log("Promoting friend!");$(".addFriendButtonDiv",c).fadeOut(400,function(){$(this).html("Request sent").addClass("requestSentNotification");$(this).fadeIn(400)})}function addFriend(a){var b=$("input.userId[value|='"+a+"']").parent();ajaxPost({personId:a},Routing.generate("WishlistUserBundle_friendAdd"),modifyAddButton,b)}function updateFriendList(d){var c=d.friends;var e=d.persons;var a=$("div.friendlist");if(a.size()==0){$("#friendsContainer").append('<div class="friendlist"></div>');a=$("div.friendlist");a.addClass("friendlist")}a.empty();if(c.length>=1){var f=[];a.append('<div id="friendSeparator" class="listSeparator">My Friends</div><div id="div_friendlist_div"><ul></ul></div>');c.forEach(function(g){f.push("<li><div class='userButton'><img class='friendIcon' src='"+g.profileUrl+"'/><a href='"+Routing.generate("WishlistUserBundle_userpage",{user_id:g.wishlistuser_id})+"'>"+g.name+"</a></div></li>")});$("#div_friendlist_div ul").append(f.join(""))}if(e.length>=1){var b=[];a.append('<div id="peopleSeparator" class="listSeparator">People on Wishenda</div><div id="div_personlist_div"><ul></ul></div>');e.forEach(function(g){b.push("<li><input class='userId' type='hidden' value='"+g.wishlistuser_id+"' /><div class='addFriendButtonDiv'><button class='addFriendButton'>Add Friend</button></div><div class='userButton'><img class='friendIcon' src='"+g.profileUrl+"'/><a href='"+Routing.generate("WishlistUserBundle_userpage",{user_id:g.wishlistuser_id})+"'></a>"+g.name+"</div></li>")});$("#div_personlist_div ul").append(b.join(""));$(".addFriendButton").button({icons:{primary:"ui-icon-plusthick"}}).click(function(i){var g=$(this).parents("li");var h=g.children("input.userId").val();addFriend(h)})}createButtonLinks()}function keyTrigger(a){if((a.keyCode>=65&&a.keyCode<=90)||a.keyCode===8||a.keyCode===16){timerRestart()}else{if(a.keyCode===13){timerEnd();searchFriends()}else{var b=removeSpecialChars($(a.srcElement).val());$(a.srcElement).val(b)}}}function createButtonLinks(){$(".userButton").click(function(){window.location=$(this).find("a").attr("href")});$("#addFriendButton").button();$("#addFriendButton").css("height","30").css("font-size","10");$("#inviteFriendButton").button();$("#inviteFriendButton").css("height","30").css("font-size","10")}function displayFriendInviteStatus(c){var b="";var a="";if(true==c){b="Success";a="Your friend has been invited to Wishenda!"}else{b="Failure";a="A problem occurred, is your friend already a member of Wishenda?"}popupMessage(b,a)}function submitFriendInvite(b){var a=false;var c=Routing.generate("WishlistUserBundle_friendInvite");ajaxPost({email:b},c,function(d){if(d.toLowerCase()=="success"){a=true}else{a=false}displayFriendInviteStatus(a);$("#friendInviteDialog").dialog("close")})}$(document).ready(function(){createButtonLinks();$("#friendSearch").keyup(keyTrigger);$("#friendInviteDialog").dialog({autoOpen:false,position:"top",resizable:false,height:300,width:500,modal:true,buttons:{Invite:function(){$("#friendInviteFormSubmit").click()}}});$("#friendInviteForm").submit(function(a){a.preventDefault();submitFriendInvite($("#newFriendEmail").val())});$("#inviteFriendButton").click(function(){$("#friendInviteDialog").dialog("open")})});